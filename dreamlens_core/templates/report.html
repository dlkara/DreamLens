{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>꿈 리포트</title>
    <link rel="stylesheet" href="{% static 'css/report.css' %}"/>
</head>
<body>
    {% include 'header.html' %}

    <h2>내 일기장 분석 리포트</h2>

    <div class="report-container">

        <!-- 월 네비게이션 -->
        <div class="month-nav">
            <a href="{% url 'report' prev_yyyymm %}" class="{% if prev_yyyymm < 202301 %}disabled{% endif %}">◀</a>
            <span id="monthText" class="clickable">{{ year }}년 {{ month }}월</span>
            <a href="{% if next_yyyymm <= today_yyyymm %}{% url 'report' next_yyyymm %}{% endif %}"
               class="{% if next_yyyymm > today_yyyymm %}disabled{% endif %}">▶</a>
        </div>

        <!-- 드롭다운 선택기 -->
        <div class="selector hidden" id="selectorBox">
            <select id="yearSelect">
                {% for y in year_list %}
                <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}년</option>
                {% endfor %}
            </select>
            <select id="monthSelect">
                {% for m in month_list %}
                <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ m }}월</option>
                {% endfor %}
            </select>
            <button id="moveBtn">이동</button>
        </div>

        <!-- 탭 -->
        <div class="tabs">
            <div class="tab active" data-target="dream">꿈 종류 분석</div>
            <div class="tab" data-target="emotion">감정 분석</div>
        </div>

        <!-- 차트 -->
        <div class="chart-wrapper">
            <!-- 꿈 종류 분석 차트 -->
            <div id="dreamChartBox" class="chart-box">
                <canvas id="dreamChart"></canvas>
            </div>

            <!-- 감정 분석 차트 -->
            <div id="emotionChartBox" class="chart-box hidden">
                <canvas id="emotionChart"></canvas>
            </div>

            {% if not has_data %}
            <p class="no-data">{{ year }}년 {{ month }}월에는 꿈 일기가 없습니다.</p>
            {% endif %}
        </div>

        <!-- 워드 클라우드 -->
        <div class="wordcloud-section">
            <h3>나의 꿈 키워드 클라우드</h3>
            <div id="wordCloudArea"></div>
            {% if not has_data %}
            <p class="no-data">{{ year }}년 {{ month }}월에는 꿈 일기가 없습니다.</p>
            {% endif %}
        </div>

    </div>

    {% include 'footer.html' %}

    <!-- 차트 & 키워드 데이터 -->
    <script>
        const dreamLabels = {{ dream_labels|safe }};
        const dreamData = {{ dream_data|safe }};
        const emotionLabels = {{ emotion_labels|safe }};
        const emotionIcons = {{ emotion_icons|safe }};
        const emotionData = {{ emotion_data|safe }};
        const keywords = {{ keywords|safe }};
        const currentYear = {{ year }};
        const currentMonth = {{ month }};
        const todayYyyymm = {{ today_yyyymm }};
        const hasData = {{ has_data|yesno:"true,false" }};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.2/src/wordcloud2.min.js"></script>
    <script defer src="{% static 'js/report.js' %}"></script>
</body>
</html>
