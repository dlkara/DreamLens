{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¿ˆ ë¶„ì„ ë¦¬í¬íŠ¸ - ê¿ˆí•´ëª½</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
    <link rel="stylesheet" href="{% static 'css/report.css' %}">

    <!-- JavaScript -->
    <script src="{% static 'js/report.js' %}" defer></script>

    <!-- ì•„ì´ì½˜ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% include 'header.html' %}

    <main class="report-main">
        <div class="container">
            <!-- í˜ì´ì§€ í—¤ë” -->
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-chart-line" style="color: var(--color-purple-main); margin-right: 12px;"></i>
                    ê¿ˆ ë¶„ì„ ë¦¬í¬íŠ¸
                </h1>
                <p class="page-subtitle">ë‹¹ì‹ ì˜ ê¿ˆì„ ë°ì´í„°ë¡œ ë¶„ì„í•´ë³´ì„¸ìš”</p>
            </div>

            <!-- ì›” ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="month-nav-card">
                <div class="month-nav">
                    <button class="nav-btn {% if prev_yyyymm < 202301 %}disabled{% endif %}"
                            onclick="{% if prev_yyyymm >= 202301 %}location.href='{% url 'report' prev_yyyymm %}'{% endif %}">
                        <i class="fas fa-chevron-left"></i>
                    </button>

                    <div class="month-display" id="monthText">
                        <i class="fas fa-calendar-alt"></i>
                        <span>{{ year }}ë…„ {{ month }}ì›”</span>
                        <i class="fas fa-chevron-down dropdown-icon"></i>
                    </div>

                    <button class="nav-btn {% if next_yyyymm > today_yyyymm %}disabled{% endif %}"
                            onclick="{% if next_yyyymm <= today_yyyymm %}location.href='{% url 'report' next_yyyymm %}'{% endif %}">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <!-- ë“œë¡­ë‹¤ìš´ ì„ íƒê¸° -->
                <div class="month-selector hidden" id="selectorBox">
                    <div class="selector-row">
                        <div class="select-group">
                            <label>ë…„ë„</label>
                            <select id="yearSelect" class="form-select">
                                {% for y in year_list %}
                                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}ë…„</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="select-group">
                            <label>ì›”</label>
                            <select id="monthSelect" class="form-select">
                                {% for m in month_list %}
                                    <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ m }}ì›”</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <button id="moveBtn" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        ì´ë™í•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- ë°ì´í„° ì—†ìŒ ìƒíƒœ -->
            {% if not has_data %}
                <div class="empty-state-card">
                    <div class="empty-state-content">
                        <div class="empty-icon">ğŸ“Š</div>
                        <h3>ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>{{ year }}ë…„ {{ month }}ì›”ì—ëŠ” ê¸°ë¡ëœ ê¿ˆì´ ì—†ì–´ìš”.<br>ìƒˆë¡œìš´ ê¿ˆì„ í•´ëª½í•´ë³´ì„¸ìš”!</p>
                        <a href="{% url 'dream_interpreter' %}" class="btn btn-primary">
                            <i class="fas fa-magic"></i>
                            ê¿ˆ í•´ëª½í•˜ëŸ¬ ê°€ê¸°
                        </a>
                    </div>
                </div>
            {% else %}
                <!-- ë¶„ì„ íƒ­ -->
                <div class="analysis-tabs-card">
                    <div class="tabs-header">
                        <h2 class="tabs-title">
                            <i class="fas fa-analytics"></i>
                            ì›”ë³„ ë¶„ì„ ë¦¬í¬íŠ¸
                        </h2>
                    </div>

                    <div class="tabs-nav">
                        <button class="tab-btn active" data-target="dream">
                            <i class="fas fa-moon"></i>
                            ê¿ˆ ì¢…ë¥˜ ë¶„ì„
                        </button>
                        <button class="tab-btn" data-target="emotion">
                            <i class="fas fa-heart"></i>
                            ê°ì • ë¶„ì„
                        </button>
                    </div>

                    <!-- ì°¨íŠ¸ ì˜ì—­ -->
                    <div class="chart-container">
                        <div id="dreamChartBox" class="chart-box">
                            <div class="chart-header">
                                <h3>ê¿ˆ ì¢…ë¥˜ë³„ ë¶„í¬</h3>
                                <p>ì´ë²ˆ ë‹¬ ì–´ë–¤ ì¢…ë¥˜ì˜ ê¿ˆì„ ë§ì´ ê¾¸ì…¨ë‚˜ìš”?</p>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="dreamChart"></canvas>
                            </div>
                        </div>

                        <div id="emotionChartBox" class="chart-box hidden">
                            <div class="chart-header">
                                <h3>ê°ì •ë³„ ë¶„í¬</h3>
                                <p>ê¿ˆì—ì„œ ëŠë‚€ ê°ì •ë“¤ì„ ë¶„ì„í•´ë³´ì„¸ìš”</p>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="emotionChart"></canvas>
                            </div>
                        </div>

                        <!-- ì°¨íŠ¸ ê²°ê³¼ í…ìŠ¤íŠ¸ -->
                        <div class="chart-result" id="chartDesc">
                            <div class="result-highlight" id="resultLabel"></div>
                        </div>
                    </div>
                </div>

                <!-- ì›Œë“œ í´ë¼ìš°ë“œ -->
                <div class="wordcloud-card">
                    <div class="wordcloud-header">
                        <h3>
                            <i class="fas fa-cloud"></i>
                            ê¿ˆ í‚¤ì›Œë“œ í´ë¼ìš°ë“œ
                        </h3>
                        <p>ê¿ˆì—ì„œ ìì£¼ ë‚˜íƒ€ë‚˜ëŠ” í‚¤ì›Œë“œë“¤ì„ ì‹œê°í™”í–ˆì–´ìš”</p>
                    </div>

                    <div class="wordcloud-container">
                        <div id="wordCloudArea"></div>
                    </div>
                </div>

                <!-- ê°ì • í‚¤ì›Œë“œ ë¶„ì„ -->
                <div class="analysis-card">
                    <div class="analysis-header">
                        <h3>
                            <i class="fas fa-brain"></i>
                            ê°ì •ë³„ í‚¤ì›Œë“œ ì—°ê´€ì„± ë¶„ì„
                        </h3>
                        <p>{{ analysis_year }}ë…„ {{ analysis_month }}ì›”ì˜ ê°ì •ê³¼ ìƒì§• ì—°ê³„ ë¶„ì„</p>
                    </div>

                    <div class="analysis-content">
                        {% if emotion_keyword_analysis %}
                            <div class="analysis-table">
                                {% for emotion, keywords in emotion_keyword_analysis.items %}
                                    <div class="analysis-row">
                                        <div class="emotion-label">
                                            <i class="fas fa-heart emotion-icon"></i>
                                            <span class="emotion-text">{{ emotion }}</span>
                                        </div>
                                        <div class="keywords-list">
                                            {% for keyword in keywords %}
                                                <span class="keyword-badge">{{ keyword }}</span>
                                            {% empty %}
                                                <span class="no-keywords">ì—°ê´€ í‚¤ì›Œë“œ ì—†ìŒ</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="no-analysis">
                                <div class="no-analysis-icon">ğŸ¤”</div>
                                <p>ë¶„ì„í•  ë°ì´í„°ê°€ ë¶€ì¡±í•´ìš”</p>
                                <span>ë” ë§ì€ ê¿ˆ ì¼ê¸°ë¥¼ ì‘ì„±í•˜ë©´ ì •í™•í•œ ë¶„ì„ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”!</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </main>

    {% include 'footer.html' %}

    <!-- JavaScript ë°ì´í„° -->
    <script>
        const dreamLabels = {{ dream_labels|safe }};
        const dreamData = {{ dream_data|safe }};
        const emotionLabels = {{ emotion_labels|safe }};
        const emotionIcons = {{ emotion_icons|safe }};
        const emotionData = {{ emotion_data|safe }};
        const keywords = {{ keywords|safe }};
        const currentYear = {{ year }};
        const currentMonth = {{ month }};
        const todayYyyymm = {{ today_yyyymm }};
        const hasData = {{ has_data|yesno:"true,false" }};
    </script>

    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.2/src/wordcloud2.min.js"></script>

    <!-- ì»¤ìŠ¤í…€ JavaScript -->
    <script defer src="{% static 'js/report.js' %}"></script>
</body>
</html>