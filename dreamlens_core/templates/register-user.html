{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì… - DreamLens</title>
    <link rel="stylesheet" href="{% static 'css/common.css' %}">
</head>
<body>
    {% include 'header.html' %}

    <main class="main-container">
        <div class="form-section register-form">
            <div class="form-header">
                <h1 class="form-title">íšŒì›ê°€ì…</h1>
                <p class="form-subtitle">ê¿ˆì˜ ì„¸ê³„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
            </div>

            <form method="POST" action="{% url 'register_user' %}" class="register-form-container">
                {% csrf_token %}

                <!-- ì•„ì´ë”” ì…ë ¥ -->
                <div class="form-group">
                    <label for="username" class="form-label">ì•„ì´ë”” <span class="required">*</span></label>
                    <div class="input-group">
                        <input
                            type="text"
                            id="username"
                            name="username"
                            placeholder="ì•„ì´ë”” (4ì ì´ìƒ)"
                            class="form-input"
                            required
                            minlength="4"
                        >
                        <button type="button" onclick="checkDuplicate()" class="btn btn-secondary btn-small">
                            ì¤‘ë³µí™•ì¸
                        </button>
                    </div>
                    <div id="id-check-msg" class="validation-message"></div>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ -->
                <div class="form-group">
                    <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        class="form-input"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password2" class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span></label>
                    <input
                        type="password"
                        id="password2"
                        name="password2"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                        class="form-input"
                        required
                    >
                </div>

                <!-- ë‹‰ë„¤ì„ -->
                <div class="form-group">
                    <label for="nickname" class="form-label">ë‹‰ë„¤ì„ <span class="required">*</span></label>
                    <input
                        type="text"
                        id="nickname"
                        name="nickname"
                        placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
                        class="form-input"
                        required
                    >
                </div>

                <!-- ìƒë…„ì›”ì¼ -->
                <div class="form-group">
                    <label for="birth" class="form-label">ìƒë…„ì›”ì¼</label>
                    <input
                        type="date"
                        id="birth"
                        name="birth"
                        class="form-input"
                    >
                </div>

                <!-- ì„±ë³„ -->
                <div class="form-group">
                    <label for="gender" class="form-label">ì„±ë³„</label>
                    <div class="select-wrapper">
                        <select name="gender" id="gender" class="form-select">
                            <option value="">ì„ íƒ ì•ˆ í•¨</option>
                            <option value="ë‚¨ì">ë‚¨ì</option>
                            <option value="ì—¬ì">ì—¬ì</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                        <div class="select-arrow">
                            <span>â–¼</span>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-large btn-full">
                    <span class="btn-icon">ğŸ‰</span>
                    íšŒì›ê°€ì…í•˜ê¸°
                </button>
            </form>

            <div class="form-footer">
                <p class="footer-text">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
                    <a href="{% url 'login' %}" class="footer-link">ë¡œê·¸ì¸</a>
                </p>
            </div>
        </div>
    </main>

    {% include 'footer.html' %}

    <script src="{% static 'js/header.js' %}"></script>
    <script>
        function checkDuplicate() {
            const username = document.querySelector('input[name="username"]').value;
            const msgTag = document.getElementById('id-check-msg');

            if (username.length < 4) {
                msgTag.className = 'validation-message error';
                msgTag.innerHTML = '<span class="message-icon">âŒ</span><span>ì•„ì´ë””ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤</span>';
                return;
            }

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            msgTag.className = 'validation-message loading';
            msgTag.innerHTML = '<span class="message-icon">â³</span><span>í™•ì¸ ì¤‘...</span>';

            fetch(`/check-username/?username=${username}`)
                .then(res => res.json())
                .then(data => {
                    if (data.exists) {
                        msgTag.className = 'validation-message error';
                        msgTag.innerHTML = '<span class="message-icon">âŒ</span><span>ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤</span>';
                    } else {
                        msgTag.className = 'validation-message success';
                        msgTag.innerHTML = '<span class="message-icon">âœ…</span><span>ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤</span>';
                    }
                })
                .catch(error => {
                    msgTag.className = 'validation-message error';
                    msgTag.innerHTML = '<span class="message-icon">âŒ</span><span>í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</span>';
                });
        }

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê²€ì¦
        document.getElementById('password2').addEventListener('input', function() {
            const password = document.getElementById('password').value;
            const password2 = this.value;

            if (password2 && password !== password2) {
                this.style.borderColor = 'var(--color-red)';
            } else {
                this.style.borderColor = 'var(--color-gray-200)';
            }
        });
    </script>
</body>
</html>